<?xml version="1.0" encoding="utf-8"?>

<!--exclude directory bin and src but copy subdirs from bin to base dir -->

<project name="elexis" default="doCopyAll">
	<property file="../../local.properties" />

	<target name="doCopyAll">
		<!-- calc source location -->
		<property name="sourceDir" value="${basedir}" />
		<property name="sourceBinDir" value="${basedir}/bin" />
		<basename property="theBaseName" file="${sourceDir}" />
		<!-- call copy functions -->
		<antcall target="doLocalCopy" inheritrefs="true" />
		<antcall target="doRemoteCopy" inheritrefs="true" />
	</target>

	<target name="doLocalCopy" unless="dontCopyToLocal">
		<!-- calc local destination -->
		<property name="destDir" value="${localFileOffset}/${theBaseName}" />
		<property name="destBinDir" value="${destDir}" />
		<!-- copy to local running copy of elexis -->
		<antcall target="doOneCopy" inheritrefs="true">
			<param name="destDir2" value="${destDir}" />
			<param name="destBinDir2" value="${destBinDir}" />
		</antcall>
	</target>

	<target name="doRemoteCopy" unless="dontCopyToRemote">
		<!-- calc remote destination -->
		<property name="destDirRemote" value="${remoteFileOffset}/${theBaseName}" />
		<property name="destBinDirRemote" value="${destDirRemote}" />
		<!-- copy to remote copy of elexis -->
		<antcall target="doOneCopy" inheritrefs="true">
			<param name="destDir2" value="${destDirRemote}" />
			<param name="destBinDir2" value="${destBinDirRemote}" />
		</antcall>
	</target>

	<target name="doOneCopy">
		<echo message="doOneCopy" />
		<copy todir="${destDir2}" overwrite="true">
			<fileset dir=".">
				<exclude name="**/bin/**" />
				<exclude name="**/src/**" />
				<exclude name="**/zzz_copyToRuntime.xml" />
			</fileset>
		</copy>
		<copy todir="${destBinDir2}" overwrite="true">
			<fileset dir="${sourceBinDir}">
				<include name="**/*.*" />
			</fileset>
		</copy>
	</target>
</project>
